# SPLUNK

- We are going to use SPLUNK AMI from AWS Marketplace.
- The Splunk Enterprise AMI accelerates the speed at which organizations deploy Splunk Enterprise in AWS. 
- Splunk Enterprise is the leading platform for Operational Intelligence, delivering an easy, fast, and secure way to search, analyze and visualize the massive streams of machine data generated by your IT systems and technology infrastructure - physical, virtual and in the cloud.

## How to?

1. If you search Splunk in AWS Marketpplace AMIs, the first one is the Splunk AMI we are going to use.

2. Click on Select

3. Select the Instance Type : **t2.micro [Free Tier Eligible]**

4. Select VPC and default Security Group and allow traffic from Anywhere

5. Launch the Instance

________________________________________________________________


Note :- You can access the Terminal of this Instance the same way for normal Instance from MobaExterm

- Username when asked on MobaExterm will be "ec2-user”
- Make sure to use exact key pair selected when creating the Instance

## INSTALL SNORT ON THIS MACHINE

- The Splunk Instance is like our centOS so apt-get update won't work

``sudo su``

``yum update``

``yum install epel-release -y``

**[Dependencies]** </br>
``yum install flex bison gcc gcc-c++ make cmake autoconf libtool git nano unzip wget libpcap-devel pcre-devel libdnet-devel hwloc-devel openssl-devel zlib-devel luajit-devel pkgconfig libnfnetlink-devel libnetfilter_queue-devel libmnl-devel -y``

**[Installing Snort]** </br>
``yum install https://forensics.cert.org/centos/cert/7/x86_64/snort-2.9.19-1.el7.x86_64.rpm``

**[Installing DAQ Libraries]** </br>
``yum install https://forensics.cert.org/centos/cert/7/x86_64/daq-2.0.7-10.1.el7.x86_64.rpm``


- We want to enable the dynamic rules, so for this purpose we will edit **/etc/snort/snort.conf**

``nano /etc/snort/snort.conf``

Edit the following :-

```
# path to dynamic preprocessor libraries
dynamicpreprocessor directory /usr/lib64/snort-2.9.19_dynamicpreprocessor/

# path to base preprocessor engine
dynamicengine /usr/lib64/snort-2.9.19_dynamicengine/libsf_engine.so

# path to dynamic rules libraries
dynamicdetection directory /usr/local/lib/snort_dynamicrules

```
**[Testing the .config file]** </br>
``sudo snort -c /etc/snort/snort.conf -T``

**Note** : If you face any error after testing, make sure to remove the Rules from  /etc/snort/snort.conf except for the local.rules


### Important Paths working with SNORT
```
1. /etc/snort/snort.conf			---> SNORT main config file
2. /var/log/snort/				---> Path where snort Logs are saved
```
**[Check if snort Installed]** </br>
``snort -V``

**[Adding demo ICMP rule]** </br>
``sudo nano /etc/snort/rules/local.rules``

*alert icmp any any -> any any ( msg:"ICMP Detected !!!";  sid:1000002; rev:1; )*

![](https://github.com/TheOneOh1/K8s-Snorty-Splunk/blob/main/rules.PNG)

**[Running Snort]** </br>
``sudo -i ens5 -c /etc/snort/snort.conf -A console``

	(-i)	-->	Interface
	(-c)	-->	Configuration file
	(-q)	-->	quiet mode, will not show on console
	(-l)	-->	log destination

- This will show the traffic on the current console
- If you want the log to be saved in /var/log/snort/

``snort -q -l /var/log/snort/ -i ens5 -A full -c /etc/snort/snort.conf``

- Log file will be named as “alert” at /var/log/snort/

![](https://github.com/TheOneOh1/K8s-Snorty-Splunk/blob/main/alert_logs.PNG)
